# ETC2.0 Analysis Toolkit (ETC)

ETC2.0 プローブデータを「行政 EBPM の説明責任」に耐える形で扱うためのツール群です。生データを一気に解釈せず、番号付きスクリプトで前処理から可視化までを段階的に進めます。個人・車両特定を目的とした利用は認めません。

## 概要
- src/ のファイル名が唯一の正。番号は処理順を表し、docs も同じ basename で整備しています。
- 第1スクリーニング → 第2スクリーニング → ビューア → 設定ファイル作成 → OD → 経路分析、という PDF の用語を踏襲。
- できること: OPID 単位分割・時系列ソート、ルート/交差点/ゾーン定義、様式1-3参照 OD リスト生成、500m 四方〜20m メッシュの経路分析。
- できないこと: 個別車両の目的地特定や違反推定、欠測データの自動補完。解析結果は推定であり、政策判断は道路管理者の責任で行ってください。

## 処理フロー（概要）
1. **前処理**: ZIP を OPID 単位にストリーミング分割し、時系列ソート（01）。
2. **設定ファイル作成 / ビューア**: ルート・交差点・ゾーンを GUI/ブラウザで定義し、抽出結果を地図で確認（05–12）。
3. **第1/第2スクリーニング**: ルート/交差点近傍のトリップを抽出して様式1-2 を生成（20–21）。
4. **性能評価・ビューア**: 速度・滞留などの指標を算出し、GUI/Excel で可視化（30–32）。
5. **OD 系**: 様式1-3参照 OD リスト作成 → ヒートマップ → ゾーン別 OD マトリクス（40–42）。
6. **経路分析**: 500m 四方・20m メッシュで方向別ヒートマップを作成（71）。

## ドキュメントへの入口
- コンセプト: [docs/00_concept.md](docs/00_concept.md)
- 処理フローとスクリプト一覧: [docs/01_pipeline.md](docs/01_pipeline.md)
- FAQ（できること/できないこと）: [docs/99_faq.md](docs/99_faq.md)
- 個別スクリプトの詳細: docs/ 配下で src と同じ basename の MD を参照（例: `src/20_route_trip_extractor.py` → `docs/20_route_trip_extractor.md`）。

## スクリプト抜粋
- 50_Path_Analysis.py：指定断面（交差点中心）を通過したトリップの「流入経路(in)」「流出経路(out)」を10mメッシュで集計し、ヒートマップHTMLを出力する。A/B判定は交通の進行方向ではなく「交差点中心にどちら側から到達したか（流入側）」で判定する。交差点ファイル2行目をA方向、3行目をB方向とし、dir_degは外側→中心の方位角として扱う。出力は (stem)_heatmap_A方向交通.html と (stem)_heatmap_B方向交通.html（左右に流入/流出を並べる）である。

## ライセンス / 守秘
本ツールは行政 EBPM 向けの分析補助に限定します。個人情報の保護と契約上の守秘義務に従い、データ取り扱いと出力共有を適切に管理してください。
