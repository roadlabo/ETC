# 32_crossroad_viewer
## 目的（何をする）
`31_crossroad_trip_performance.py` が出力した交差点性能 CSV を GUI で閲覧し、フィルタ・グラフ描画・Excel/画像出力を行う。現場確認用のビューア兼レポート整形ツール。
## 位置づけ（分析フロー上のどこ）
- **ビューア**フェーズ（交差点性能）。
- PDF 用語の「ビューア」で、性能 CSV を使ったレポート作成・確認を担う。
## 入力
- 交差点性能 CSV（cp932, ヘッダ付き）: `{crossroad}_performance.csv`。
- GUI で読み込む前提のため、ファイルパスをダイアログで指定。
## 出力
- GUI 上でのグラフ表示に加え、Excel ファイルと PNG を生成可能。
- Excel には性能テーブルとグラフ画像を貼り付ける（openpyxl を使用）。
## 実行方法
- 必要ライブラリ: PySide6, matplotlib, pandas, openpyxl。
- コマンド例: `python 32_crossroad_viewer.py` → GUI 起動 → 「ファイルを開く」で性能 CSV を選択。
- カレンダーやリストで日付/枝を選択し、速度分布・通過件数などを確認。エクスポートボタンで Excel/画像を保存。
## 判定ロジック（重要なものだけ）
- pandas で CSV を読み込み、枝番号・方向・速度を基にグラフを生成。
- カレンダーウィジェットの選択日付に合わせてレコードをフィルタ。
- openpyxl でフォーマット済みワークシートを作り、matplotlib 画像を貼り付け。
## できること / できないこと（行政向けの注意）
- できること: 交差点性能の目視確認、日付/枝別のフィルタリング、Excel 添付用の静的レポート作成。
- できないこと: 新たな性能指標の計算、FLAG/距離閾値の変更、ブラウザ経由の共有。ビューアで見える値は 31 の出力に依存し、再計算は行わない。
## よくあるミス
- 必要ライブラリ未インストールで GUI 起動に失敗。
- 文字コードが cp932 以外の CSV を読み込んで文字化け。
- グラフ用フォント（メイリオ等）が環境に無く、図が崩れる。
## 関連スクリプト
- 前段: [docs/31_crossroad_trip_performance.md](./31_crossroad_trip_performance.md)。
- フロー全体: [docs/01_pipeline.md](./01_pipeline.md)
