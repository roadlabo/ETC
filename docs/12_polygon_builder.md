# 12_polygon_builder
## 目的（何をする）
ゾーニング用の多角形をブラウザで作成・編集し、CSV として保存する。OD マトリクス作成時のゾーン定義や、閲覧用の領域マスクを人手で準備する。
## 位置づけ（分析フロー上のどこ）
- **設定ファイル作成**フェーズ。
- PDF 用語での「設定ファイル作成（ゾーン）」。42_OD_extractor のゾーン割当で使用し、40/41 系の可視化とも整合させる。
## 入力
- ブラウザでの手動描画。既存 CSV を読み込む場合は 1 行目: ゾーン名、以降は `lon,lat` のペアを繰り返した形式（UTF-8/BOM 可）。
- SNAP_PX=15 により既存点へのスナップが可能。ESC で 1 点戻し。
## 出力
- 各行: `zone_name,lon1,lat1,lon2,lat2,...`（UTF-8 BOM 付き、CRLF）。
- ファイル名はダイアログで指定し、ブラウザのダウンロードフォルダに保存。
## 実行方法
- HTML をブラウザで開く（ローカルで直接開く想定）。
- 操作: 左クリック=点追加、右クリック=既存点へスナップ、[ゾーン登録] で一覧に追加、[保存] で CSV ダウンロード。[既存ゾーニングデータを読込] で CSV をマージ/上書き。
## 判定ロジック（重要なものだけ）
- 自己交差を検出し、無効なポリゴンは登録させない。
- 同名ゾーンが既に存在する場合は上書き登録。
- Leaflet 上に全ポリゴンとラベルを再描画し、一覧も同期更新。
## できること / できないこと（行政向けの注意）
- できること: 手描きゾーンの迅速な作成・修正、既存 CSV の読み込み/追記、Excel で開ける形式での保存。
- できないこと: 境界データの自動取得や GIS 精度の保証、ポリゴンのトポロジ検証（隣接/包含関係チェックなし）。ゾーン設計の妥当性判断は担当者が行う必要がある。
## よくあるミス
- 3 点未満で登録しようとして拒否される。
- ゾーン名を空のまま登録し、保存後に判別できなくなる。
- ブラウザの権限設定でダウンロードがブロックされる。
## 関連スクリプト
- 後段: [docs/42_OD_extractor.md](./42_OD_extractor.md)（ゾーン割当・OD マトリクス作成）。
- フロー全体: [docs/01_pipeline.md](./01_pipeline.md)
