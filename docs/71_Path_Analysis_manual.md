# 71_Path_Analysis.py マニュアル（流入側A/B判定・流入/流出経路ヒートマップ）
１．目的本スクリプトは、指定断面（交差点中心ポイント）を通過したトリップについて、交差点に到達するまでの「流入経路」と、交差点通過後の「流出経路」を500m四方・10mメッシュで集計し、地図上にヒートマップとして可視化する。
２．用語と判定定義本スクリプトのA/B判定は「交通の進行方向」ではなく「交差点中心ポイントにどちら側から到達したか（流入側）」で判定する。交差点ファイル2行目（タイトル除く）をA方向、3行目をB方向とし、各dir_degは「外側→中心（outside→center）」の方位角として扱う。したがって、地図上の矢印も中心に向かう向きで描画する。inは流入経路（交差点に入るまでの軌跡）を表し、outは流出経路（交差点を出た後の軌跡）を表す。
３．入力データ①交差点ファイル（11_crossroad_sampler.py の出力CSV）2行目がA方向、3行目がB方向であり、dir_degは外側→中心の向きとする。②トリップデータ（当該パイプラインの通過トリップ抽出結果）各トリップは連続点列（経度緯度）を持つ。
４．出力ファイル①子ヒートマップ（4枚）(交差点ファイル名stem)_heatmap_A（流入）.html(交差点ファイル名stem)_heatmap_A（流出）.html(交差点ファイル名stem)_heatmap_B（流入）.html(交差点ファイル名stem)_heatmap_B（流出）.html②並べ表示（2枚）(交差点ファイル名stem)_heatmap_A方向交通.html（A方向交通の流入経路と流出経路を左右に表示）(交差点ファイル名stem)_heatmap_B方向交通.html（B方向交通の流入経路と流出経路を左右に表示）※A方向交通画面にはA矢印のみ、B方向交通画面にはB矢印のみを表示する。
５．見方（誤認識防止）A方向交通とは「A方向（外側）から交差点中心へ到達した交通」を指す。B方向交通とは「B方向（外側）から交差点中心へ到達した交通」を指す。A方向交通（流入経路）は交差点到達までに通ってきた場所の分布である。A方向交通（流出経路）は交差点通過後に通っていく場所の分布である。B方向交通も同様である。A/Bは向き（進行方向）ではないため、向きの解釈を混同しない。
６．矢印表示矢印は「外側→中心」に向かう矢印とし、線の先端（中心側）に三角形の矢じりを描画する。矢印の意味が流入側判定と一致するように統一する。
７．ヒートマップ濃淡設定ヒートマップは少ない領域を薄く、多い領域を赤く強調する。vmaxは上位パーセンタイルで飽和させ、外れ値の影響を抑える。設定値はスクリプト冒頭のHEATMAP_*定数で調整する。
