# 10_route_sampler
## 目的（何をする）
ブラウザ上で地図をクリックし、サンプルルートを作図して CSV として保存する。第1/第2スクリーニングで参照する基準ルートを人手で定義するためのツール。
## 位置づけ（分析フロー上のどこ）
- **設定ファイル作成**フェーズ。
- PDF 用語での「ルート定義作成」に対応し、20 系・05/06 系で再利用する基準データを提供。
## 入力
- なし（マップ UI 上でクリックして点を追加）。
- OSM タイルを利用。初期座標は津山市役所周辺（35.069095, 134.004512）。
## 出力
- CSV（ヘッダなし、UTF-8）。列仕様（0 始まり）:
  - E=TYPE: `2` 固定、F=USE: `1` 固定、G=TIME: 先頭から10秒刻みの時刻文字列、M=FLAG: `2` 固定、O=lon, P=lat（小数10桁）、S=SPEED: `30.0` 固定、その他は `0` 埋め。
- 保存先は `--outdir`（未指定ならスクリプトと同階層）、ファイル名は `--filename`（拡張子 `.csv` を自動付与）。

※作業フォルダ構成は `docs/05_work_folder_structure.md` を正とする。  
本スクリプトの成果物は `{PROJECT_ID}/10_ルート(Route)データ/`（該当番号フォルダ）に出力して運用する。
## 実行方法
- コマンド例: `python 10_route_sampler.py --outdir "D:\\ETC" --filename "route_sample.csv" --port 5009`
- Flask が起動し、ブラウザが自動で `http://127.0.0.1:<port>/` を開く。左クリックで点追加、右クリックで直前の点削除、「保存」で CSV 書き出し。
## 判定ロジック（重要なものだけ）
- クリックされた点を 20m 等間隔に再サンプリングし、30°以上の折れ点を必ず保持。
- 線形補間は緯度経度の線形補間（短距離前提）、FLAG=2 で全行を揃え、時間は 10 秒刻みで連番付与。
- 出力は route_mapper_simple / trip_extractor と列順互換に整形。
## できること / できないこと（行政向けの注意）
- できること: 目視でルート形状を定義し、後続の抽出で参照できる CSV を即時作成。FLAG/TYPE/USE を既定値で固定し、他ツールとの整合を担保。
- できないこと: 実測データとの自動フィッティング、測位誤差を踏まえたスナップ、自動のルート短縮。あくまで人手定義の基準データであり、交通量の結論を示さない。
## よくあるミス
- 右クリックでの削除を知らず、誤点を残したまま保存する。
- O/P 列を入れ替えた旧版 CSV を混在させる（本版は O=lon, P=lat が正）。
- ポート競合で Flask が起動しない。
## 関連スクリプト
- 後段: [docs/05_route_mapper_simple.md](./05_route_mapper_simple.md) / [docs/06_route_mapper_kp.md](./06_route_mapper_kp.md)（作図結果の確認）、[docs/20_route_trip_extractor.md](./20_route_trip_extractor.md)（抽出で参照）。
- フロー全体: [docs/01_pipeline.md](./01_pipeline.md)
