# 33_branch_check.py マニュアル

## 目的
`*_performance.csv`（交差点パフォーマンスCSV）を読み込み、
枝判定（流入枝番/流出枝番）の妥当性を地図の軌跡と数値で目視確認します。
評価指標の主軸は遅れ時間(s)です。

## 入力CSV
- 対象: `*_performance.csv`（交差点パフォーマンスCSV）
- 想定例: `01nomura_performance.csv` / `03higashiitinomiya_performance.csv` / `12minamisaka_performance.csv`
- 起動時にファイルダイアログで選択可能
- 文字コードは `cp932 → shift_jis → utf-8` の順に試行
- 同階層の `11_交差点(Point)データ/交差点名.csv` を自動で探して読み込みます
  - 交差点名は `*_performance.csv` の末尾 `_performance.csv` を除いた部分です
  - 例: `03higashiitinomiya_performance.csv` → `11_交差点(Point)データ/03higashiitinomiya.csv`

## 起動方法
```bash
python src/33_branch_check.py
```

または
```bash
python src/33_branch_check.py --csv /path/to/xxx_performance.csv
```

## 操作方法
- 左の表でトリップ一覧を表示
- ↑ / ↓ キーで行選択を移動
- 選択変更に応じて右の地図が更新

## 表示内容
### 地図
- 指定中心点（交差点定義CSVで指定）を赤で表示
- 算出中心点（トリップ軌跡のうち指定中心に最も近い線分上最近接点）をマーカーで表示
- 計測開始点 → 算出中心点 → 計測終了点 の2本の線分（折れ）で表示
- 開始/終了マーカーとラベル（IN/OUT枝番・角度差）
- 2区間（開始→算出中心→終了）を順に動くアニメーションマーカー
- 基準枝（枝番号ラベル付きレイ）と選択トリップを同一地図に表示
- 自動fitで枝全体とトリップがバランスよく収まるように表示

### 詳細パネル
- 交差点ファイル名
- 運行日
- 曜日
- 自動車の種別
- 用途
- 所要時間(s)
- 閑散時所要時間(s)
- 遅れ時間(s)
- 所要時間算出可否/不可理由
- 流入枝番
- 流出枝番
- 流入角度差(deg)
- 流出角度差(deg)
- 角度算出方式
- 計測距離(m)
- 交差点通過速度(km/h)（参考/任意）

## 注意
- Point CSV が見つからない場合は警告を表示し、基準枝なしモードで起動します
- OSMタイル取得にネットワーク接続が必要です。オフライン環境では地図表示ができません。
- 本ツールは分析結果確定ではなく品質確認（検証）用です。
