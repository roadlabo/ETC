# 33_branch_check.py マニュアル

## 目的
`03higashiitinomiya_performance.csv`（枝判定済みの交差点通過パフォーマンス）を読み込み、
各トリップの「流入枝番／流出枝番」が妥当かを地図上の動きとラベルで目視確認します。

## 入力CSV
- 対象: `03higashiitinomiya_performance.csv`
- 起動時にファイルダイアログで選択可能
- 文字コードは `cp932 → shift_jis → utf-8` の順に試行

## 起動方法
```bash
python src/33_branch_check.py
```

または
```bash
python src/33_branch_check.py --csv /path/to/03higashiitinomiya_performance.csv
```

## 操作方法
- 左の表でトリップ一覧を表示
- ↑ / ↓ キーで行選択を移動
- 選択変更に応じて右の地図が更新

## 表示内容
### 地図
- 交差点中心（指定中心）を基準に、半径200mの円を表示し、その範囲に自動ズーム
- 指定中心点（交差点定義CSVで指定）を赤で表示
- 算出中心点（トリップ軌跡のうち指定中心に最も近い線分上最近接点）をマーカーで表示
- 計測開始点 → 算出中心点 → 計測終了点 の2本の線分（折れ）で表示
- 開始/終了マーカーとラベル（IN/OUT枝番・角度差）
- 2区間（開始→算出中心→終了）を順に動くアニメーションマーカー
- 参考表示: 流入枝番ごとの代表方向レイ（中心→120m）

### 詳細パネル
- 交差点ファイル名
- 運行日
- 曜日
- 自動車の種別
- 用途
- 流入枝番
- 流出枝番
- 流入角度差(deg)
- 流出角度差(deg)
- 角度算出方式
- 計測距離(m)
- 所要時間(s)
- 交差点通過速度(km/h)

## 注意
- OSMタイル取得にネットワーク接続が必要です。オフライン環境では地図表示ができません。
